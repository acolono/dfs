@section Styles {
    <style>
        html, body {height: 100%; font-family: "Lucida Console", Monaco, monospace; font-size: 300%; background: #ccc}
        score {
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
}


<score v-on:click="fullscreen">
    score: {{score}}
</score>

@section Scripts {
    <script>
        var conn = new signalR.HubConnectionBuilder().withUrl("/appHub").build();
        var vm = new Vue({
            el: "score",
            data: { score: 0 },
            methods: {
                fullscreen: () => {
                    fullscreen(vm.$el);
                }
            }
        });

        function goDownTo(nr) {
            return new Promise(function (resolve, reject) {
                var iv = setInterval(() => {
                    if (vm.score > nr) {
                        vm.score--;
                    } else {
                        clearInterval(iv);
                        resolve();
                    }
                }, 15);
            });
        }

        conn.on("SetScore", score => {
            setTimeout(() => {
                goDownTo(score);
            },2000);
        });
        function fullscreen(a) { a.requestFullScreen ? a.requestFullScreen() : a.mozRequestFullScreen ? a.mozRequestFullScreen() : a.webkitRequestFullScreen && a.webkitRequestFullScreen() };
        conn.start();

        setInterval(() => {
            conn.invoke("Ping").catch(e => {
                alert("error: " + e);
                location.reload(true);
            });
        },10000);
    </script>

}
